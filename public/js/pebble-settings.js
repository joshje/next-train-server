(function(){function e(){}function i(e,t){var n=e.length;while(n--)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}var t=e.prototype,n=this,r=n.EventEmitter;t.getListeners=function(t){var n=this._getEvents(),r,i;if(t instanceof RegExp){r={};for(i in n)n.hasOwnProperty(i)&&t.test(i)&&(r[i]=n[i])}else r=n[t]||(n[t]=[]);return r},t.flattenListeners=function(t){var n=[],r;for(r=0;r<t.length;r+=1)n.push(t[r].listener);return n},t.getListenersAsObject=function(t){var n=this.getListeners(t),r;return n instanceof Array&&(r={},r[t]=n),r||n},t.addListener=function(t,n){var r=this.getListenersAsObject(t),s=typeof n=="object",o;for(o in r)r.hasOwnProperty(o)&&i(r[o],n)===-1&&r[o].push(s?n:{listener:n,once:!1});return this},t.on=s("addListener"),t.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:!0})},t.once=s("addOnceListener"),t.defineEvent=function(t){return this.getListeners(t),this},t.defineEvents=function(t){for(var n=0;n<t.length;n+=1)this.defineEvent(t[n]);return this},t.removeListener=function(t,n){var r=this.getListenersAsObject(t),s,o;for(o in r)r.hasOwnProperty(o)&&(s=i(r[o],n),s!==-1&&r[o].splice(s,1));return this},t.off=s("removeListener"),t.addListeners=function(t,n){return this.manipulateListeners(!1,t,n)},t.removeListeners=function(t,n){return this.manipulateListeners(!0,t,n)},t.manipulateListeners=function(t,n,r){var i,s,o=t?this.removeListener:this.addListener,u=t?this.removeListeners:this.addListeners;if(typeof n!="object"||n instanceof RegExp){i=r.length;while(i--)o.call(this,n,r[i])}else for(i in n)n.hasOwnProperty(i)&&(s=n[i])&&(typeof s=="function"?o.call(this,i,s):u.call(this,i,s));return this},t.removeEvent=function(t){var n=typeof t,r=this._getEvents(),i;if(n==="string")delete r[t];else if(t instanceof RegExp)for(i in r)r.hasOwnProperty(i)&&t.test(i)&&delete r[i];else delete this._events;return this},t.removeAllListeners=s("removeEvent"),t.emitEvent=function(t,n){var r=this.getListenersAsObject(t),i,s,o,u;for(o in r)if(r.hasOwnProperty(o)){s=r[o].length;while(s--)i=r[o][s],i.once===!0&&this.removeListener(t,i.listener),u=i.listener.apply(this,n||[]),u===this._getOnceReturnValue()&&this.removeListener(t,i.listener)}return this},t.trigger=s("emitEvent"),t.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)},t.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},t._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},t._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return n.EventEmitter=r,e},typeof define=="function"&&define.amd?define("eventEmitter",[],function(){return e}):typeof module=="object"&&module.exports?module.exports=e:n.EventEmitter=e}).call(this);var Hogan={};(function(e,t){function n(e,t,n){var r,i;return t&&typeof t=="object"&&(t[e]!=null?r=t[e]:n&&t.get&&typeof t.get=="function"&&(r=t.get(e))),r}function r(e,t,n,r){function i(){}function s(){}i.prototype=e,s.prototype=e.subs;var o,u=new i;u.subs=new s,u.subsText={},u.ib();for(o in t)u.subs[o]=t[o],u.subsText[o]=r;for(o in n)u.partials[o]=n[o];return u}function l(e){return String(e===null||e===undefined?"":e)}function c(e){return e=l(e),f.test(e)?e.replace(i,"&amp;").replace(s,"&lt;").replace(o,"&gt;").replace(u,"&#39;").replace(a,"&quot;"):e}e.Template=function(e,t,n,r){e=e||{},this.r=e.code||this.r,this.c=n,this.options=r||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.ib()},e.Template.prototype={r:function(e,t,n){return""},v:c,t:l,render:function(t,n,r){return this.ri([t],n||{},r)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],i=t[n.name];if(n.instance&&n.base==i)return n.instance;if(typeof i=="string"){if(!this.c)throw new Error("No compiler available.");i=this.c.compile(i,this.options)}return i?(this.partials[e].base=i,n.subs&&(this.activeSub===undefined&&(t.stackText=this.text),i=r(i,n.subs,n.partials,t.stackText||this.text)),this.partials[e].instance=i,i):null},rp:function(e,t,n,r){var i=this.ep(e,n);return i?i.ri(t,n,r):""},rs:function(e,t,n){var r=e[e.length-1];if(!h(r)){n(e,t,this);return}for(var i=0;i<r.length;i++)e.push(r[i]),n(e,t,this),e.pop()},s:function(e,t,n,r,i,s,o){var u;return h(e)&&e.length===0?!1:(typeof e=="function"&&(e=this.ms(e,t,n,r,i,s,o)),u=!!e,!r&&u&&t&&t.push(typeof e=="object"?e:t[t.length-1]),u)},d:function(e,t,r,i){var s,o=e.split("."),u=this.f(o[0],t,r,i),a=this.options.modelGet,f=null;if(e==="."&&h(t[t.length-2]))u=t[t.length-1];else for(var l=1;l<o.length;l++)s=n(o[l],u,a),s!=null?(f=u,u=s):u="";return i&&!u?!1:(!i&&typeof u=="function"&&(t.push(f),u=this.mv(u,t,r),t.pop()),u)},f:function(e,t,r,i){var s=!1,o=null,u=!1,a=this.options.modelGet;for(var f=t.length-1;f>=0;f--){o=t[f],s=n(e,o,a);if(s!=null){u=!0;break}}return u?(!i&&typeof s=="function"&&(s=this.mv(s,t,r)),s):i?!1:""},ls:function(e,t,n,r,i){var s=this.options.delimiters;return this.options.delimiters=i,this.b(this.ct(l(e.call(t,r)),t,n)),this.options.delimiters=s,!1},ct:function(e,t,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");return this.buf=[],e}:function(){var e=this.buf;return this.buf="",e},ib:function(){this.buf=t?[]:""},ms:function(e,t,n,r,i,s,o){var u,a=t[t.length-1],f=e.call(a);return typeof f=="function"?r?!0:(u=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(f,a,n,u.substring(i,s),o)):f},mv:function(e,t,n){var r=t[t.length-1],i=e.call(r);return typeof i=="function"?this.ct(l(i.call(r)),r,n):i},sub:function(e,t,n,r){var i=this.subs[e];i&&(this.activeSub=e,i(t,n,this,r),this.activeSub=!1)}};var i=/&/g,s=/</g,o=/>/g,u=/\'/g,a=/\"/g,f=/[&<>\"\']/,h=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(e){function o(e){e.n.substr(e.n.length-1)==="}"&&(e.n=e.n.substring(0,e.n.length-1))}function u(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function a(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}function l(t,n,r,i){var s=[],o=null,u=null,a=null;u=r[r.length-1];while(t.length>0){a=t.shift();if(!(!u||u.tag!="<"||a.tag in f))throw new Error("Illegal content in < super tag.");if(e.tags[a.tag]<=e.tags.$||c(a,i))r.push(a),a.nodes=l(t,a.tag,r,i);else{if(a.tag=="/"){if(r.length===0)throw new Error("Closing tag without opener: /"+a.n);o=r.pop();if(a.n!=o.n&&!h(a.n,o.n,i))throw new Error("Nesting error: "+o.n+" vs. "+a.n);return o.end=a.i,s}a.tag=="\n"&&(a.last=t.length==0||t[0].tag=="\n")}s.push(a)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return s}function c(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function h(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function p(e){var t=[];for(var n in e)t.push('"'+m(n)+'": function(c,p,t,i) {'+e[n]+"}");return"{ "+t.join(",")+" }"}function d(e){var t=[];for(var n in e.partials)t.push('"'+m(n)+'":{name:"'+m(e.partials[n].name)+'", '+d(e.partials[n])+"}");return"partials: {"+t.join(",")+"}, subs: "+p(e.subs)}function m(e){return e.replace(s,"\\\\").replace(n,'\\"').replace(r,"\\n").replace(i,"\\r")}function g(e){return~e.indexOf(".")?"d":"f"}function y(e,t){var n="<"+(t.prefix||""),r=n+e.n+v++;return t.partials[r]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+m(r)+'",c,p,"'+(e.indent||"")+'"));',r}function b(e,t){t.code+="t.b(t.t(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'}function w(e){return"t.b("+e+");"}var t=/\S/,n=/\"/g,r=/\n/g,i=/\r/g,s=/\\/g;e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(r,i){function S(){v.length>0&&(m.push({tag:"_t",text:new String(v)}),v="")}function x(){var n=!0;for(var r=b;r<m.length;r++){n=e.tags[m[r].tag]<e.tags._v||m[r].tag=="_t"&&m[r].text.match(t)===null;if(!n)return!1}return n}function T(e,t){S();if(e&&x())for(var n=b,r;n<m.length;n++)m[n].text&&((r=m[n+1])&&r.tag==">"&&(r.indent=m[n].text.toString()),m.splice(n,1));else t||m.push({tag:"\n"});g=!1,b=m.length}function N(e,t){var n="="+E,r=e.indexOf(n,t),i=u(e.substring(e.indexOf("=",t)+1,r)).split(" ");return w=i[0],E=i[i.length-1],r+n.length-1}var s=r.length,f=0,l=1,c=2,h=f,p=null,d=null,v="",m=[],g=!1,y=0,b=0,w="{{",E="}}";i&&(i=i.split(" "),w=i[0],E=i[1]);for(y=0;y<s;y++)h==f?a(w,r,y)?(--y,S(),h=l):r.charAt(y)=="\n"?T(g):v+=r.charAt(y):h==l?(y+=w.length-1,d=e.tags[r.charAt(y+1)],p=d?r.charAt(y+1):"_v",p=="="?(y=N(r,y),h=f):(d&&y++,h=c),g=y):a(E,r,y)?(m.push({tag:p,n:u(v),otag:w,ctag:E,i:p=="/"?g-w.length:y+E.length}),v="",y+=E.length-1,h=f,p=="{"&&(E=="}}"?y++:o(m[m.length-1]))):v+=r.charAt(y);return T(g,!0),m};var f={_t:!0,"\n":!0,$:!0,"/":!0};e.stringify=function(t,n,r){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+d(t)+"}"};var v=0;e.generate=function(t,n,r){v=0;var i={code:"",subs:{},partials:{}};return e.walk(t,i),r.asString?this.stringify(i,n,r):this.makeTemplate(i,n,r)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,n){var r=this.makePartials(e);return r.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(r,t,this,n)},e.makePartials=function(e){var t,n={subs:{},partials:e.partials,name:e.name};for(t in n.partials)n.partials[t]=this.makePartials(n.partials[t]);for(t in e.subs)n.subs[t]=new Function("c","p","t","i",e.subs[t]);return n},e.codegen={"#":function(t,n){n.code+="if(t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),'+"c,p,0,"+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",e.walk(t.nodes,n),n.code+="});c.pop();}"},"^":function(t,n){n.code+="if(!t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,n),n.code+="};"},">":y,"<":function(t,n){var r={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,r);var i=n.partials[y(t,n)];i.subs=r.subs,i.partials=r.partials},$:function(t,n){var r={subs:{},code:"",partials:n.partials,prefix:t.n};e.walk(t.nodes,r),n.subs[t.n]=r.code,n.inPartial||(n.code+='t.sub("'+m(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=w('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=w('"'+m(e.text)+'"')},"{":b,"&":b},e.walk=function(t,n){var r;for(var i=0,s=t.length;i<s;i++)r=e.codegen[t[i].tag],r&&r(t[i],n);return n},e.parse=function(e,t,n){return n=n||{},l(e,"",[],n.sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,n){n=n||{};var r=e.cacheKey(t,n),i=this.cache[r];return i?i:(i=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[r]=i)}}(typeof exports!="undefined"?exports:Hogan),typeof define=="function"&&define.amd&&define("hogan",Hogan),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("hgn",["hogan","text"],function(e,t){function o(i,s,o,f){var l=f.hgn||{},c=i;c+=l&&l.templateExtension!=null?l.templateExtension:n,t.get(s.toUrl(c),function(t){var n=l.compilationOptions?a({},l.compilationOptions):{};f.isBuild&&(n.asString=!0,r[i]=e.compile(t,n));var s=e.compile(t,n),c=u(s.render,s);c.text=s.text,c.template=s,o(c)})}function u(e,t){return function(){return e.apply(t,arguments)}}function a(e,t){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function f(t,n,o){if(n in r){s||(s=e.compile(i));var u=r[n];o(s.render({pluginName:t,moduleName:n,fn:u}))}}var n=".mustache",r={},i='define("{{pluginName}}!{{moduleName}}", ["hogan"], function(hogan){  var tmpl = new hogan.Template({{{fn}}}, "", hogan);  function render(){ return tmpl.render.apply(tmpl, arguments); } render.template = tmpl; return render;});\n',s;return{load:o,write:f}}),define("hgn!templates/journeys",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="header">'),r.b("\n"+n),r.b('  <div class="header-button-area">'),r.b("\n"+n),r.b('    <button class="header-button" data-journeys-action="save">Save</button>'),r.b("\n"+n),r.b("  </div>"),r.b("\n"+n),r.b("  <h1>Journeys</h1>"),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b('<div class="journeys wrap">'),r.b("\n"+n),r.b('  <ul class="journeys-list">'),r.b("\n"+n),r.s(r.f("journeys",e,t,1),e,t,0,240,533,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('    <li class="journeys-list-item">'),r.b("\n"+n),r.b('      <span class="journeys-list-item-text" data-journeys-action="edit" data-index="'),r.b(r.v(r.f("index",e,t,0))),r.b('">'),r.b(r.v(r.d("from.text",e,t,0))),r.b(" to "),r.b(r.v(r.d("to.text",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b('      <span class="journeys-list-item-remove" data-journeys-action="delete" data-index="'),r.b(r.v(r.f("index",e,t,0))),r.b('">Remove</span>'),r.b("\n"+n),r.b("    </li>"),r.b("\n"+n)}),e.pop()),r.b("  </ul>"),r.b("\n"+n),r.b('  <button class="journeys-add" data-journeys-action="add">Add Journey</button>'),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("views/journeys",["eventEmitter","hgn!templates/journeys"],function(e,t){var n=new e,r;return n.init=function(e){r=e.contentEl,r.addEventListener("click",function(e){var t=e.target,r=t.getAttribute("data-journeys-action");if(!r)return;e.preventDefault();var i;r=="add"?n.emit("add"):r=="edit"?(i=parseInt(t.getAttribute("data-index"),10),n.emit("edit",{index:i})):r=="delete"?(i=parseInt(t.getAttribute("data-index"),10),n.emit("delete",{index:i})):r=="save"&&n.emit("save")},!0)},n.render=function(e){var n=e.journeys.map(function(e,t){return{from:e.from,to:e.to,index:t}});r.innerHTML=t({journeys:n})},n}),define("data/stations",[],function(){var e=function(e){var t=new XMLHttpRequest;t.onload=function(){var t=JSON.parse(this.responseText);e({stations:t})},t.open("get","/api/stations",!0),t.send()};return{fetch:e}}),define("hgn!templates/journey",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="header">'),r.b("\n"+n),r.b('  <div class="header-button-area">'),r.b("\n"+n),r.b('    <button class="header-button header-button-back" data-journey-action="cancel">Journeys</button>'),r.b("\n"+n),r.b("  </div>"),r.b("\n"+n),r.b("  <h1>"),r.b(r.v(r.f("title",e,t,0))),r.b("</h1>"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.b("\n"+n),r.b('<div class="journey wrap'),r.s(r.f("isEdit",e,t,1),e,t,0,229,238,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.b(" can-save")}),e.pop()),r.b('">'),r.b("\n"+n),r.b('  <div class="journey-part" data-journey-part="from">'),r.b("\n"+n),r.b('    <input class="journey-part-input" type="text" placeholder="From" value="'),r.s(r.f("journey",e,t,1),e,t,0,394,420,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.s(n.f("from",e,t,1),e,t,0,403,411,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b(n.v(n.f("text",e,t,0)))}),e.pop())}),e.pop()),r.b('">'),r.b("\n"+n),r.b('    <div class="journey-part-stations"></div>'),r.b("\n"+n),r.b("  </div>"),r.b("\n"),r.b("\n"+n),r.b('  <div class="journey-part" data-journey-part="to">'),r.b("\n"+n),r.b('    <input class="journey-part-input" type="text" placeholder="To" value="'),r.s(r.f("journey",e,t,1),e,t,0,629,651,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.s(n.f("to",e,t,1),e,t,0,636,644,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b(n.v(n.f("text",e,t,0)))}),e.pop())}),e.pop()),r.b('">'),r.b("\n"+n),r.b('    <div class="journey-part-stations"></div>'),r.b("\n"+n),r.b("  </div>"),r.b("\n"),r.b("\n"+n),r.b('  <button class="journey-save" data-journey-action="save">Save</button>'),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/station-list",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<ul class="station-list">'),r.b("\n"+n),r.s(r.f("stations",e,t,1),e,t,0,41,146,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('    <li class="station-list-item" data-journey-action="station" data-station="'),r.b(r.v(r.f("code",e,t,0))),r.b('">'),r.b(r.v(r.f("text",e,t,0))),r.b("</li>"),r.b("\n"+n)}),e.pop()),r.b("</ul>"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("views/journey",["eventEmitter","data/stations","hgn!templates/journey","hgn!templates/station-list"],function(e,t,n,r){var i=new e,s=[],o={},u,a,f,l=function(e){while((e=e.parentElement)&&!e.classList.contains("journey-part"));return e},c=function(e,t){var n=e.getAttribute("data-journey-part"),i;n=="from"?i=a.to&&a.to.code:n=="to"&&(i=a.from&&a.from.code);var o;t=t.toLowerCase(),o=s.filter(function(e){if(i&&e.code==i)return!1;if(!t)return!0;var n=e.text.toLowerCase();if(n.indexOf(t)!==-1)return!0;var r=e.code.toLowerCase();if(r.indexOf(t)!==-1)return!0}),e.querySelector(".journey-part-stations").innerHTML=r({stations:o})};return i.init=function(e){u=e.contentEl,t.fetch(function(e){s=e.stations;for(var t=s.length-1;t>=0;t--)o[s[t].code]=s[t]}),u.addEventListener("focus",function(e){var t=e.target,n=t.classList.contains("journey-part-input");n&&c(l(t),"")},!0),u.addEventListener("keyup",function(e){var t=e.target,n=t.classList.contains("journey-part-input");n&&c(l(t),e.target.value)},!0),u.addEventListener("click",function(e){var t=e.target,n=t.getAttribute("data-journey-action");if(!n)return;e.preventDefault();if(n=="save")i.emit("save",{journey:a,index:f});else if(n=="cancel")i.emit("cancel");else if(n=="station"){var r=t.getAttribute("data-station"),s=l(e.target),c=s.getAttribute("data-journey-part"),h=o[r];a[c]=h,s.querySelector(".journey-part-input").value=h.text,s.querySelector(".journey-part-stations").innerHTML="",a.from&&a.to&&u.querySelector(".journey").classList.add("can-save")}},!0)},i.render=function(e){u.innerHTML=n(e)},i.renderNew=function(){a={},f=null,i.render({title:"Add Journey"})},i.renderEdit=function(e){a=e.journey,f=e.index,i.render({title:"Edit Journey",journey:a,isEdit:!0})},i}),define("utils/pebble",[],function(){var e=function(){var e=location.hash.split("#"),t=e[e.length-1];if(!t)return{};var n=JSON.parse(decodeURIComponent(t));return n},t=function(){var e=location.hash.substring(location.hash.indexOf("?")+1),t=e.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]=="return_to")return decodeURIComponent(r[1].split("#")[0])}return"pebblejs://close#"},n=function(e){return encodeURIComponent(JSON.stringify(e))},r=function(e){var r=t()+n(e);console.log("close",r),document.location=r};return{getConfig:e,close:r}}),require.config({paths:{text:"../lib/requirejs-hogan-plugin/text",hogan:"../lib/requirejs-hogan-plugin/hogan",hgn:"../lib/requirejs-hogan-plugin/hgn",eventEmitter:"../lib/eventEmitter/EventEmitter"}}),require(["views/journeys","views/journey","utils/pebble"],function(e,t,n){var r=n.getConfig();r.journeys=r.journeys||[];var i=document.querySelector("[data-content]");e.init({contentEl:i}),t.init({contentEl:i}),e.render({journeys:r.journeys}),e.on("add",function(){t.renderNew()}),e.on("edit",function(e){t.renderEdit({journey:r.journeys[e.index],index:e.index})}),e.on("delete",function(t){r.journeys.splice(t.index,1),e.render({journeys:r.journeys})}),e.on("save",function(){n.close({journeys:r.journeys})}),t.on("save",function(t){t.index||t.index===0?r.journeys[t.index]=t.journey:r.journeys.push(t.journey),e.render({journeys:r.journeys})}),t.on("cancel",function(){e.render({journeys:r.journeys})})}),define("main.js",function(){});